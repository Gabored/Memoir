<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Comentarios</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
    <h1>Lista de Comentarios</h1>
    <div id="comments-list"></div>
    
    <form id="create-comment-form">
        <!-- Aquí irían los campos del formulario para crear un nuevo comentario -->
        <input type="text" name="writer_user" placeholder="Nombre de usuario"><br>
        <input type="text" name="post_id" placeholder="ID de publicación"><br>
        <textarea name="body" placeholder="Cuerpo del comentario"></textarea><br>
        <input type="checkbox" name="reply" id="reply">
        <label for="reply">Es una respuesta</label><br>
        <button type="submit">Crear Comentario</button>
    </form>

    <script>
        $(function(){
            const commentsListDiv = $('#comments-list');
            const createCommentForm = $('#create-comment-form');

            // Función para cargar todos los comentarios
            const loadComments = () => {
                $.ajax({
                    url: 'http://localhost:5001/comments', // Reemplaza esta URL por la correcta
                    type: 'GET',
                    success: (comments) => {
                        commentsListDiv.empty(); // Limpia el div antes de cargar los comentarios

                        comments.forEach(comment => {
                            const commentDiv = $(`
                                <div>
                                    <p><strong>${comment.writer_user}</strong></p>
                                    <p>${comment.body}</p>
                                    <hr>
                                </div>
                            `);
                            commentsListDiv.append(commentDiv);
                        });
                    },
                    error: () => {
                        console.error('Error al obtener la lista de comentarios');
                    }
                });
            };

            // Cargar los comentarios al cargar la página
            loadComments();

           // Evento de envío del formulario para crear un comentario
            createCommentForm.on('submit', function(event) {
                event.preventDefault();

                // Obtener datos del formulario
                const writer_user = $('input[name="writer_user"]').val();
                const post_id = $('input[name="post_id"]').val();
                const body = $('textarea[name="body"]').val();
                const reply = $('input[name="reply"]').is(':checked');

                const commentData = {
                    writer_user,
                    post_id,
                    body,
                    reply
                };

                // Realizar la solicitud AJAX para crear el comentario
                $.ajax({
                    url: 'http://localhost:5001/comments',
                    type: 'POST',
                    data: JSON.stringify(commentData),
                    contentType: 'application/json',
                    success: () => {
                        alert('Comentario creado exitosamente');
                        loadComments(); // Cargar la lista actualizada de comentarios
                        createCommentForm[0].reset();
                    },
                    error: () => {
                        alert('Error al crear el comentario');
                    }
                });

                return false;
            });

        });
    </script>
</body>
</html>
