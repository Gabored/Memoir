<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style-explorar.css">
    <title>Lista de Hashtags</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>

    <div id="header-container">
        <div id="header-section">
            <img id="add-hashtag-image" src="..\media\add-hashtag.png" alt="Crear Hashtag" onclick="showCreateHashtagForm()">
            <p id="add-hashtag-message" onclick="showCreateHashtagForm()">Crea tu propio hashtag</p>
        </div>
    </div>
    
    <div id="hashtag-list"></div>

    <!-- Formulario para crear hashtag -->
    <div id="create-hashtag-form">
        <h2>Crea tu propio hashtag</h2>
        <form id="hashtag-form">
            <label for="hashtag-title">Título del Hashtag:</label>
            <input type="text" id="hashtag-title" name="hashtag-title" required>

            <label for="hashtag-image">Link de la Imagen:</label>
            <input type="text" id="hashtag-image" name="hashtag-image" required>

            <button type="button" onclick="createHashtag()">Crear Hashtag</button>
        </form>
    </div>

    <script>
    function loadHashtags() {
        let url = 'http://localhost:5001/hashtags';

        $.ajax({
            url: url,
            type: 'GET',
            dataType: 'json',
            success: (data) => {
                let html = '';
                if (Array.isArray(data) && data.length > 0) {
                    data.forEach(hashtag => {
                        html += `<div class="hashtag-item">`;
                        html += `<img class="hashtag-img" src="${hashtag.img}" alt="${hashtag.name}">`;
                        html += `<span class="hashtag-name">${hashtag.name}</span>`;
                        html += `</div>`;
                    });
                } else {
                    html = '<p>No se encontraron hashtags</p>';
                }
                $('#hashtag-list').html(html);
            },
            error: (xhr, status, error) => {
                console.error('Error al obtener la lista de hashtags:', error);
            }
        });
    }

    // CREAR HASHTAG
    function showCreateHashtagForm() {
            // Muestra el formulario de creación de hashtag
            document.getElementById("create-hashtag-form").style.display = "block";
        }

    function createHashtag() {
        var title = document.getElementById("hashtag-title").value;
        var image = document.getElementById("hashtag-image").value;

        // Validar que los campos no estén vacíos
        if (!title || !image) {
            alert("Por favor, completa todos los campos.");
            return;
        }

        // Datos a enviar al servidor
        var hashtagData = {
            name: title,
            img: image
        };

        // Enviar la solicitud al servidor
        $.ajax({
            url: 'http://localhost:5001/hashtags',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(hashtagData),
            success: function(response) {
                // Manejar la respuesta del servidor, si es necesario
                console.log(response);

                // Opcional: Recargar la lista de hashtags después de crear uno nuevo
                loadHashtags();

                // Ocultar el formulario después de crear el hashtag
                document.getElementById("create-hashtag-form").style.display = "none";
            },
            error: function(xhr, status, error) {
                console.error('Error al crear el hashtag:', error);
                alert('Error al crear el hashtag. Por favor, intenta nuevamente.');
            }
        });
    }

        $(function(){
            loadHashtags(); // Carga los hashtags al iniciar la página
        });
    </script>
</body>
</html>
